<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Assistant Chat</title>
<style>
/* RESET */
* { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
body {background:#1c1c1c; color:#e0e0e0; overflow-x:hidden; display:flex; flex-direction:column; min-height:100vh; font-size:18px;}

/* HEADER */
header {
  background:#2a2a2a; 
  padding:20px; 
  text-align:center; 
  font-size:28px; 
  position:relative; 
  display:flex; 
  align-items:center; 
  justify-content:center;
}
#logoBtn {
  position:absolute;
  left:15px; 
  top:15px; 
  width:50px; 
  height:50px; 
  cursor:pointer; 
  border-radius:50%; 
  background:#333; 
  display:flex; 
  align-items:center; 
  justify-content:center;
  font-weight:bold;
  font-size:20px;
  transition: all 0.3s;
}
#logoBtn:hover{
  background:#444;
  transform: scale(1.1) rotate(15deg);
}

/* SIDEBAR */
#sidebar{
  height:100%;
  width:0;
  position:fixed;
  top:0;
  left:0;
  background:#2a2a2a;
  overflow-x:hidden;
  transition:0.4s;
  padding-top:60px;
  box-shadow:2px 0 10px #111;
}
#sidebar h2{color:#e0e0e0;text-align:center;margin-bottom:20px; font-size:24px;}
#sidebar ul{list-style:none;padding:0 15px;}
#sidebar li{margin-bottom:12px;padding:10px;background:#333;border-radius:6px;cursor:pointer;color:#e0e0e0;transition:0.3s; font-size:18px;}
#sidebar li:hover{background:#444;}
#closeSidebar {
  position:absolute;
  top:15px;
  right:15px;
  background:#333;
  color:#e0e0e0;
  border:none;
  padding:6px 12px;
  cursor:pointer;
  border-radius:6px;
  transition:0.3s;
  font-size:16px;
}
#closeSidebar:hover{background:#444; transform: scale(1.05);}

/* CHAT BOX */
#chatBox{
  flex:1;
  height:60vh;
  overflow-y:auto;
  padding:20px;
  background:#2a2a2a;
  margin-left:0;
  transition:margin-left 0.4s;
}
.message{
  padding:14px 18px;
  margin:12px 0;
  max-width:75%;
  border-radius:14px;
  word-wrap:break-word;
  background:#333;
  font-size:18px;
}
.user{margin-left:auto;}
.ai{margin-right:auto;}

/* CODE BLOCK */
.codeBlock{
  background:#333;
  color:#e0e0e0;
  padding:12px;
  border-radius:8px;
  font-family:monospace;
  position:relative;
  font-size:16px;
}
.codeButtons{
  position:absolute;top:5px;right:5px;
}
.codeButtons button{
  margin-left:5px;padding:4px 8px;font-size:14px;border:none;border-radius:4px;cursor:pointer;background:#444;color:#e0e0e0;
}

/* INPUT AREA */
.bottom{
  display:flex;
  padding:12px;
  background:#2a2a2a;
  position:fixed;
  bottom:0;
  width:100%;
}
#userInput{flex:1;padding:18px;border-radius:25px;border:none;background:#333;color:#e0e0e0; font-size:18px;}
#sendBtn{
  width:55px;
  height:55px;
  margin-left:10px;
  border-radius:50%;
  border:none;
  background:#333;
  color:#e0e0e0;
  font-size:24px;
  cursor:pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}
#sendBtn:hover{
  transform: scale(1.2);
  box-shadow: 0 0 15px #555;
}

/* VOICE BUTTON */
#assistantBtn{
  position:fixed;
  bottom:90px;
  right:20px;
  width:65px;
  height:65px;
  border-radius:50%;
  background:#333;
  color:#e0e0e0;
  font-size:32px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 10px #444;
  transition: all 0.3s;
}
#assistantBtn:hover{box-shadow:0 0 20px #555; transform: scale(1.05);}
</style>
</head>
<body>

<header>
  <div id="logoBtn" title="Chat History">ðŸ’»</div>
  What are you going to make today?
</header>

<div id="sidebar">
  <button id="closeSidebar">Close</button>
  <h2>Chat History</h2>
  <ul id="historyList"></ul>
</div>

<div id="chatBox"></div>

<div class="bottom">
  <input id="userInput" placeholder="What are you going to make today?">
  <button id="sendBtn">â¬†</button>
</div>

<div id="assistantBtn" title="Voice Input">ðŸŽ¤</div>

<script>
const BACKEND = "http://localhost:5000";
let chatHistory = [];

// Sidebar toggle
const sidebar = document.getElementById("sidebar");
const chatBox = document.getElementById("chatBox");
const logoBtn = document.getElementById("logoBtn");
const closeSidebar = document.getElementById("closeSidebar");

logoBtn.onclick = () => {
  sidebar.style.width = "250px";
  chatBox.style.marginLeft = "250px";
};
closeSidebar.onclick = () => {
  sidebar.style.width = "0";
  chatBox.style.marginLeft = "0";
};

// Add message
function addMessage(text,type,isCode=false){
  const div=document.createElement("div");
  div.className=`message ${type}`;
  
  if(isCode || text.includes("```")){
    const codeContent = text.replace(/```/g,"");
    const codeDiv = document.createElement("div");
    codeDiv.className="codeBlock";
    codeDiv.innerText = codeContent;

    // Copy/Edit buttons only for code
    const btnDiv = document.createElement("div");
    btnDiv.className="codeButtons";
    const copyBtn = document.createElement("button");
    copyBtn.innerText="Copy";
    copyBtn.onclick=()=>{navigator.clipboard.writeText(codeContent);}
    const editBtn = document.createElement("button");
    editBtn.innerText="Edit";
    editBtn.onclick=()=>{document.getElementById("userInput").value = codeContent; document.getElementById("userInput").focus();}
    btnDiv.appendChild(copyBtn);
    btnDiv.appendChild(editBtn);
    codeDiv.appendChild(btnDiv);

    div.appendChild(codeDiv);
  } else {
    div.innerText=text;
  }

  chatBox.appendChild(div);
  chatBox.scrollTop=chatBox.scrollHeight;

  const historyList=document.getElementById("historyList");
  const li=document.createElement("li");
  li.innerText=(type==="user"?"You: ":"AI: ") + text.replace(/```/g,"");
  li.onclick=()=>{document.getElementById("userInput").value=text.replace(/```/g,""); sendChat();}
  historyList.appendChild(li);
}

// Send chat to backend
async function sendChat(){
  const input=document.getElementById("userInput");
  const msg=input.value.trim();
  if(!msg) return;
  addMessage(msg,"user");
  chatHistory.push({type:"user",text:msg});
  input.value="";

  try{
    const res=await fetch(BACKEND+"/api/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:msg})
    });
    const data=await res.json();
    let reply = data.reply || "Sorry, I couldn't respond.";
    
    // Detect if response contains code
    const isCode = reply.includes("```");

    addMessage(reply,"ai",isCode);

    // Only speak if message contains code or specific keywords
    if(isCode){
      speak(reply);
    }

    chatHistory.push({type:"ai",text:reply});
  }catch(e){console.error(e);}
}

// Voice input
document.getElementById("assistantBtn").onclick=()=>{
  const recognition=new (window.SpeechRecognition||window.webkitSpeechRecognition)();
  recognition.lang="en-US";
  recognition.start();
  recognition.onresult=e=>{
    const msg=e.results[0][0].transcript;
    document.getElementById("userInput").value=msg;
    sendChat();
  };
};

// Voice output
function speak(text){
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang="en-US";
  speechSynthesis.speak(utter);
}

// Send button & Enter key
document.getElementById("sendBtn").onclick=sendChat;
document.getElementById("userInput").addEventListener("keypress",e=>{if(e.key==="Enter") sendChat();});
</script>
</body>
</html>
